var isIE=(typeof document.all!='undefined'&&typeof window.opera=='undefined'&&navigator.vendor!='KDE');
function $(e){return document.getElementById(e)}
function $text(e){return document.createTextNode(e)}
function $element(e,t){var n=document.createElement(e);var r;var i;if(t){for(var s in t){if(s){i=s.toLowerCase();if(i=="innerhtml"){n.appendChild($text(t[s]))}else{switch(i){case"classname":r=isIE?"className":"class";break;case"for":r="htmlFor";break;default:r=s;break}n.setAttribute(r,t[s])}}}}return n}
function $target(e,t,n){var r;var i=n||1;var s=0;if(e.nodeType==1||e==document){r=e}else if(typeof e=="string"){r=document.getElementById(e)}else{var o=typeof e=="undefined"?window.event:e;r=typeof o.target!="undefined"?o.target:o.srcElement;while(r.nodeType==3&&r.parentNode!==null){r=r.parentNode}}var u=(t||r.nodeName).toUpperCase();var a=r==document?false:true;while(a){if(r.nodeName!=u){r=r.parentNode}if(r.nodeName==u){s++}if(s==i){break}else{r=r.parentNode}if(r.nodeName=="#document"){r=null;break}}return r}
function $event(e){var t=typeof e=="undefined"?window.event:e;if(typeof t.pageX=="undefined"){var n=getScrollingPosition();t.pageX=t.clientX+n.X;t.pageY=t.clientY+n.Y}return t}
function $listen(e,t,n,r){var i=$target(e);if(typeof i.addEventListener!="undefined"){i.addEventListener(t,n,r||false)}else if(typeof i.attachEvent!="undefined"){i.attachEvent("on"+t,n)}else{t="on"+t;if(typeof i[t]=="function"){var s=i[t];i[t]=function(){s();return n()}}else{i[t]=n}}return true}
function $ignore(e,t,n,r){var i=$target(e);if(typeof i.removeEventListener!="undefined"){i.removeEventListener(t,n,r||false)}else if(typeof i.detachEvent!="undefined"){i.detachEvent("on"+t,n)}else{i["on"+t]=null}return true}
SNAKE_ENGINE={};(function(){var e={container:"",size:[20,30],color:"grey",callback:function(e,t){},cells:"",board:[],directionMap:{R:[0,1],L:[0,-1],U:[-1,0],D:[1,0]},snakeTimer:"",snakeSpeed:0,grow:false,direction:"R",directionArray:[],snakeArray:[],foodLocation:"",foodCount:0};var t={setBoard:function(){var n=parseInt(e.size[1]/2)-1;for(var r=4;r>=0;r--){thisCell=e.board[n][r];thisCell.style.backgroundColor=e.color;e.snakeArray.push([n,r].join())}t.placeFood()},gameCycle:function(){e.direction=e.directionArray.shift()||e.direction;var n;var r=e.snakeArray[0].split(",");var i=e.directionMap[e.direction];var s=[parseInt(r[0])+i[0],parseInt(r[1])+i[1]];var o=e.board[s[0]];var u=true;if(typeof o!=="undefined"){n=o[s[1]];if(typeof n!=="undefined"){u=false}}if(u||e.snakeArray.indexOf(s.join())!==-1){t.endGame();return}e.snakeArray.unshift(s.join());n.style.backgroundColor=e.color;if(n===e.foodLocation){t.eatFood(n)}if(!e.grow){var a=e.snakeArray.pop().split(",");e.board[a[0]][a[1]].style.backgroundColor="inherit"}e.grow=false},placeFood:function(t){while(true){e.foodLocation=e.cells[Math.floor(Math.random()*e.size[0]*e.size[1])];if(e.foodLocation.style.backgroundColor!==e.color){break}}e.foodLocation.innerHTML="<span>*</span>"},eatFood:function(){e.grow=true;e.foodLocation.innerHTML="";e.foodCount++;t.placeFood();e.callback("ate",e.foodCount)},endGame:function(){clearInterval(e.snakeTimer);$ignore(document,"keydown",t.delegate(this,t.arrowListener));e.callback("ended","game over")},arrowListener:function(t){var n=$event(t).keyCode;var r={37:"L",38:"U",39:"R",40:"D"};if(n in r&&[["L","R"],["U","D"]][n%2].indexOf(e.direction)!==-1){e.directionArray[e.directionArray.length]=r[n];e.direction=r[n]}},delegate:function(e,t){return function(){t.apply(e,arguments)};return this},configure:function(t){var n=["container","size","color","callback"];var r;for(var i=0;i<n.length;i++){r=n[i];if(typeof t[r]!=="undefined"){e[r]=t[r]}}}};this.init=function(n){t.configure(n);var r=$element("TABLE",{id:"board"});var i=$element("TBODY");var s,o;for(var u=0;u<e.size[1];u++){e.board[u]=[];s=$element("TR");for(var a=0;a<e.size[0];a++){e.board[u][a]=$element("TD");s.appendChild(e.board[u][a])}i.appendChild(s);r.appendChild(i)}e.cells=i.getElementsByTagName("TD");e.container.appendChild(r);t.setBoard();return r};this.start=function(n){e.snakeSpeed={slow:300,med:200,fast:100}[n];$listen(document,"keydown",t.delegate(this,t.arrowListener));e.snakeTimer=setInterval(t.delegate(this,t.gameCycle),e.snakeSpeed)};this.reset=function(){e.foodLocation.removeChild(e.foodLocation.firstChild);while(e.snakeArray.length){var n=e.snakeArray.pop();n=n.split(",");e.board[n[0]][n[1]].style.backgroundColor="inherit"}e.direction="R";e.directionArray=[];e.foodLocation="";e.foodCount=0;t.setBoard()}}).apply(SNAKE_ENGINE);
Game={};(function(e){var t={multiplier:0,gameTime:0,timer:""};var n={controller:function(e,n){switch(e){case"ate":$("score").innerHTML=t.multiplier*n;break;case"ended":$("again").style.display="inline-block";$("msg").style.display="block";clearInterval(t.timer);break}},startGame:function(r){var i=$target(r);if(i.nodeName==="BUTTON"){$("buttons").style.display="none";e.start(i.id);t.multiplier={slow:1,med:2,fast:3}[i.id];t.gameTime=new Date;t.timer=setInterval(function(){n.setGameTime()},1e3)}},resetGame:function(t){$("again").style.display="none";$("buttons").style.display="inline-block";$("msg").style.display="none";$("score").innerHTML=0;$("mins").innerHTML=0;$("seconds").innerHTML="00";e.reset()},setGameTime:function(){var e=parseInt((new Date-t.gameTime)/1e3);var n=("0"+e%60).slice(-2);var r=parseInt(e/60);$("mins").innerHTML=r;$("seconds").innerHTML=n}};$listen("buttons","click",n.startGame);$listen("again","click",n.resetGame);e.init({container:$("field"),size:[20,25],color:"red",callback:n.controller})}).apply(Game,[SNAKE_ENGINE]);